name: Deploy docs to pages

on:
    push:
        branches: ["main"]
    workflow_dispatch:


permissions:
    contents: read
    pages: write
    id-token: write

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v3

            - name: Set up Rust
              uses: actions-rs/toolchain@v1
              with:
                    profile: minimal
                    toolchain: stable

            - name: Build docs
              run: |
                cargo doc --no-deps --document-private-items
                echo '<meta http-equiv="refresh" content="0; url=simplebuffers_core">' > target/doc/index.html

            - name: Setup pages
              uses: actions/configure-pages@v3

            - name: Upload artifact
              uses: actions/upload-pages-artifact@v2
              with:
                    path: 'target/doc'

    deploy:
        environment:
            name: github-pages
            url: ${{ steps.deployment.outputs.page_url }}
        runs-on: ubuntu-latest
        needs: build
        steps:
            - name: Deploy to pages
              id: deployment
              uses: actions/deploy-pages@v2